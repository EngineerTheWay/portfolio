---
import { type CollectionEntry, getCollection, render } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/sections/Header.astro";
import Footer from "../../components/sections/Footer.astro";
import ProjectsPost from "../../layouts/ProjectsPost.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../../consts";

export async function getStaticPaths() {
  const projects = await getCollection("projects");

  return projects.map((project) => {
    const safeSlug = project.slug ?? project.id.replace(/\.mdx?$/, "");
    return {
      params: { slug: safeSlug },
      props: project,
    };
  });
}

type Props = CollectionEntry<"projects">;
const project = Astro.props;
const { Content } = await render(project);
---

<html lang="en" data-theme="dark" class="dark">
  <head>
    <BaseHead
      title={`${project.data.title} â€“ ${SITE_TITLE}`}
      description={project.data.description ?? SITE_DESCRIPTION}
    />
  </head>
  <body>
    <Header />
    <main class="mx-auto max-w-6xl px-4 py-10">
      <ProjectsPost {...project.data}>
        <Content />
      </ProjectsPost>
    </main>
    <Footer />
  </body>
</html>
